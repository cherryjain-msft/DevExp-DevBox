# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/refs/heads/main/schemas/v1.0/azure.yaml.json

name: ContosoDevExp

hooks:
  preprovision:
    shell: pwsh
    continueOnError: false
    interactive: true
    run: |
      # PowerShell equivalent of the bash script

      # Set error action preference to stop on errors (equivalent to 'set -e')
      $ErrorActionPreference = "Stop"

      # Define default platform
      $defaultPlatform = "github"

      # Check if the environment variable is set and handle accordingly
      if ([string]::IsNullOrEmpty($env:SOURCE_CONTROL_PLATFORM)) {
          Write-Host "SOURCE_CONTROL_PLATFORM is not set. Setting it to '$defaultPlatform' by default."
          $env:SOURCE_CONTROL_PLATFORM = $defaultPlatform
      }
      else {
          Write-Host "Existing SOURCE_CONTROL_PLATFORM is set to '$($env:SOURCE_CONTROL_PLATFORM)'."
      }

      # Execute the setup script with parameters
      .\setup.ps1 -e $env:AZURE_ENV_NAME -s $env:SOURCE_CONTROL_PLATFORM